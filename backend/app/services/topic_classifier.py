from __future__ import annotations
from __future__ import annotations

from typing import Sequence

TOPIC_KEYWORDS: dict[str, set[str]] = {
    "Технологии": {"technology", "tech", "ai", "искусственный", "интеллект", "стартап", "робот", "цифров", "software", "hardware", "программирование", "разработка", "it", "информационные технологии", "гаджет", "устройство", "смартфон", "компьютер"},
    "Кибербезопасность": {"cyber", "security", "хакер", "кибер", "vulnerability", "breach", "уязвим", "malware", "шифр", "защита", "безопасность", "вирус", "взлом", "данные"},
    "Экономика": {"эконом", "economy", "market", "финанс", "bank", "инфляц", "бирж", "investment", "ipo", "рынок", "деньги", "валюта", "рубль", "доллар", "евро", "инвестиции", "бизнес", "компания", "предприятие"},
    "Геополитика": {"полит", "санкции", "конфликт", "war", "geopolitics", "переговор", "election", "война", "мир", "дипломатия", "страна", "государство", "президент", "правительство", "международные отношения"},
    "Общество": {"общество", "society", "education", "образован", "health", "здоров", "люди", "население", "социальный", "пенсия", "зарплата", "работа", "безработица", "медицина", "больница", "врач"},
    "Культура": {"culture", "культура", "art", "музей", "music", "фестиваль", "film", "cinema", "кино", "театр", "выставка", "концерт", "книга", "литература", "писатель", "художник"},
    "Наука": {"science", "наука", "research", "исслед", "space", "космос", "эксперимент", "ученый", "открытие", "изобретение", "лаборатория", "исследование", "астрономия", "физика", "химия", "биология"},
    "Спорт": {"sport", "match", "team", "спорт", "игр", "лига", "футбол", "хоккей", "баскетбол", "теннис", "олимпиада", "чемпионат", "соревнование", "атлет", "тренер"},
    "Медиа": {"media", "streaming", "youtube", "netflix", "spotify", "hulu", "disney", "tiktok", "телевидение", "радио", "интернет", "социальные сети", "блог", "подкаст"},
    "Экология": {"ecology", "экология", "климат", "climate", "окружающая среда", "природа", "загрязнение", "выбросы", "энергия", "возобновляемая", "солнечная", "ветровая", "электричество"},
    "Транспорт": {"transport", "транспорт", "автомобиль", "машина", "дорога", "поезд", "самолет", "метро", "общественный транспорт", "пробка", "авария"},
    "Недвижимость": {"недвижимость", "квартира", "дом", "строительство", "жилье", "ипотека", "аренда", "покупка", "продажа"},
    "Образование": {"образование", "школа", "университет", "студент", "учитель", "экзамен", "диплом", "обучение", "курс", "лекция"},
    "Здоровье": {"здоровье", "медицина", "лечение", "болезнь", "врач", "больница", "лекарство", "вакцина", "профилактика"},
    "Развлечения": {"развлечения", "игра", "игрок", "киберспорт", "стрим", "контент", "юмор", "комедия", "шоу"},
}


def classify(text: str, top_k: int = 3) -> list[str]:
    normalized = text.lower()
    scores: list[tuple[int, str]] = []
    for topic, keywords in TOPIC_KEYWORDS.items():
        score = sum(1 for keyword in keywords if keyword in normalized)
        if score:
            scores.append((score, topic))
    scores.sort(reverse=True, key=lambda item: item[0])
    top_topics = [topic for _, topic in scores[:top_k]]
    return top_topics or ["Общее"]


def batch_classify(texts: Sequence[str], top_k: int = 3) -> list[list[str]]:
    return [classify(text, top_k=top_k) for text in texts]
